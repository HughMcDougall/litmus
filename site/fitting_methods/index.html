
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Hugh McDougall">
      
      
        <link rel="canonical" href="https://github.com/HughMcDougall/litmus/fitting_methods/">
      
      
        <link rel="prev" href="../models/">
      
      
        <link rel="next" href="../litmusclass/">
      
      
      <link rel="icon" href="../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>fittingmethods - LITMUS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#litmusfitting_methods" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="LITMUS" class="md-header__button md-logo" aria-label="LITMUS" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LITMUS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              fittingmethods
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/HughMcDougall/litmus/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HughMcDougall/litmus/
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="LITMUS" class="md-nav__button md-logo" aria-label="LITMUS" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    LITMUS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/HughMcDougall/litmus/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    HughMcDougall/litmus/
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Code Docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Code Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    For Users
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            For Users
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    fittingmethods
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    fittingmethods
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#litmus.fitting_methods" class="md-nav__link">
    <span class="md-ellipsis">
      fitting_methods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure" class="md-nav__link">
    <span class="md-ellipsis">
      fitting_procedure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fitting_procedure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.stat_model" class="md-nav__link">
    <span class="md-ellipsis">
      stat_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.is_ready" class="md-nav__link">
    <span class="md-ellipsis">
      is_ready
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.has_prefit" class="md-nav__link">
    <span class="md-ellipsis">
      has_prefit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.has_run" class="md-nav__link">
    <span class="md-ellipsis">
      has_run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.fitting_params" class="md-nav__link">
    <span class="md-ellipsis">
      fitting_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.seed" class="md-nav__link">
    <span class="md-ellipsis">
      seed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.reset" class="md-nav__link">
    <span class="md-ellipsis">
      reset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.set_config" class="md-nav__link">
    <span class="md-ellipsis">
      set_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.readyup" class="md-nav__link">
    <span class="md-ellipsis">
      readyup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.prefit" class="md-nav__link">
    <span class="md-ellipsis">
      prefit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.get_samples" class="md-nav__link">
    <span class="md-ellipsis">
      get_samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.get_evidence" class="md-nav__link">
    <span class="md-ellipsis">
      get_evidence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.get_information" class="md-nav__link">
    <span class="md-ellipsis">
      get_information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.get_peaks" class="md-nav__link">
    <span class="md-ellipsis">
      get_peaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.fitting_procedure.diagnostic_lagplot" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostic_lagplot
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF" class="md-nav__link">
    <span class="md-ellipsis">
      ICCF
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ICCF">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF.lags" class="md-nav__link">
    <span class="md-ellipsis">
      lags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF.samples" class="md-nav__link">
    <span class="md-ellipsis">
      samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF.correls" class="md-nav__link">
    <span class="md-ellipsis">
      correls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF.lag_mean" class="md-nav__link">
    <span class="md-ellipsis">
      lag_mean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF.lag_err" class="md-nav__link">
    <span class="md-ellipsis">
      lag_err
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF.set_config" class="md-nav__link">
    <span class="md-ellipsis">
      set_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF.readyup" class="md-nav__link">
    <span class="md-ellipsis">
      readyup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF.get_samples" class="md-nav__link">
    <span class="md-ellipsis">
      get_samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.ICCF.get_peaks" class="md-nav__link">
    <span class="md-ellipsis">
      get_peaks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#litmus.fitting_methods.prior_sampling" class="md-nav__link">
    <span class="md-ellipsis">
      prior_sampling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="prior_sampling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.prior_sampling.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.prior_sampling.samples" class="md-nav__link">
    <span class="md-ellipsis">
      samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.prior_sampling.log_prior" class="md-nav__link">
    <span class="md-ellipsis">
      log_prior
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.prior_sampling.log_likes" class="md-nav__link">
    <span class="md-ellipsis">
      log_likes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.prior_sampling.log_density" class="md-nav__link">
    <span class="md-ellipsis">
      log_density
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.prior_sampling.weights" class="md-nav__link">
    <span class="md-ellipsis">
      weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.prior_sampling.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.prior_sampling.get_samples" class="md-nav__link">
    <span class="md-ellipsis">
      get_samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.prior_sampling.get_evidence" class="md-nav__link">
    <span class="md-ellipsis">
      get_evidence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.prior_sampling.get_information" class="md-nav__link">
    <span class="md-ellipsis">
      get_information
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling" class="md-nav__link">
    <span class="md-ellipsis">
      nested_sampling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="nested_sampling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling.sampler" class="md-nav__link">
    <span class="md-ellipsis">
      sampler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling.logevidence" class="md-nav__link">
    <span class="md-ellipsis">
      logevidence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling.priorvolume" class="md-nav__link">
    <span class="md-ellipsis">
      priorvolume
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling.prefit" class="md-nav__link">
    <span class="md-ellipsis">
      prefit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling.get_samples" class="md-nav__link">
    <span class="md-ellipsis">
      get_samples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling.get_evidence" class="md-nav__link">
    <span class="md-ellipsis">
      get_evidence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling.get_information" class="md-nav__link">
    <span class="md-ellipsis">
      get_information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling.get_peaks" class="md-nav__link">
    <span class="md-ellipsis">
      get_peaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.nested_sampling.diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan" class="md-nav__link">
    <span class="md-ellipsis">
      hessian_scan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="hessian_scan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.lags" class="md-nav__link">
    <span class="md-ellipsis">
      lags
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.converged" class="md-nav__link">
    <span class="md-ellipsis">
      converged
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.scan_peaks" class="md-nav__link">
    <span class="md-ellipsis">
      scan_peaks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.log_evidences" class="md-nav__link">
    <span class="md-ellipsis">
      log_evidences
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.log_evidences_uncert" class="md-nav__link">
    <span class="md-ellipsis">
      log_evidences_uncert
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.diagnostic_hessians" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostic_hessians
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.diagnostic_densities" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostic_densities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.diagnostic_grads" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostic_grads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.diagnostic_ints" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostic_ints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.diagnostic_tgrads" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostic_tgrads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.params_toscan" class="md-nav__link">
    <span class="md-ellipsis">
      params_toscan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.precon_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      precon_matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.solver" class="md-nav__link">
    <span class="md-ellipsis">
      solver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.estmap_params" class="md-nav__link">
    <span class="md-ellipsis">
      estmap_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.readyup" class="md-nav__link">
    <span class="md-ellipsis">
      readyup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.estimate_MAP" class="md-nav__link">
    <span class="md-ellipsis">
      estimate_MAP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.make_grid" class="md-nav__link">
    <span class="md-ellipsis">
      make_grid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.prefit" class="md-nav__link">
    <span class="md-ellipsis">
      prefit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.refit" class="md-nav__link">
    <span class="md-ellipsis">
      refit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.diagnostic_lagplot" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostic_lagplot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.get_evidence" class="md-nav__link">
    <span class="md-ellipsis">
      get_evidence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.hessian_scan.get_samples" class="md-nav__link">
    <span class="md-ellipsis">
      get_samples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#litmus.fitting_methods.SVI_scan" class="md-nav__link">
    <span class="md-ellipsis">
      SVI_scan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SVI_scan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.SVI_scan.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.SVI_scan.diagnostic_losses" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostic_losses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.SVI_scan.diagnostic_loss_init" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostic_loss_init
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.SVI_scan.diagnostic_ints" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostic_ints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.SVI_scan.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.SVI_scan.refit" class="md-nav__link">
    <span class="md-ellipsis">
      refit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.SVI_scan.diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      diagnostics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#litmus.fitting_methods.JAVELIKE" class="md-nav__link">
    <span class="md-ellipsis">
      JAVELIKE
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JAVELIKE">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.JAVELIKE.sampler" class="md-nav__link">
    <span class="md-ellipsis">
      sampler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.JAVELIKE.kernel" class="md-nav__link">
    <span class="md-ellipsis">
      kernel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.JAVELIKE.limited_model" class="md-nav__link">
    <span class="md-ellipsis">
      limited_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.JAVELIKE.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.JAVELIKE.readyup" class="md-nav__link">
    <span class="md-ellipsis">
      readyup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.JAVELIKE.prefit" class="md-nav__link">
    <span class="md-ellipsis">
      prefit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.JAVELIKE.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#litmus.fitting_methods.JAVELIKE.get_samples" class="md-nav__link">
    <span class="md-ellipsis">
      get_samples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../litmusclass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    litmusclass
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lightcurve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lightcurve
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mocks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mocks
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    For Developers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            For Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lin_scatter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lin_scatter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GP_working/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GP_working
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utilities and Typing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gettingstarted/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="litmusfitting_methods"><code>litmus.fitting_methods</code></h1>


<div class="doc doc-object doc-module">



<a id="litmus.fitting_methods"></a>
    <div class="doc doc-contents first">

        <p>Contains fitting procedures to be executed by the litmus class object</p>
<p>HM 24</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="litmus.fitting_methods.fitting_procedure" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">fitting_procedure</span><span class="p">(</span><span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span> <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="              logger(out_stream=sys.stdout, err_stream=sys.stderr, verbose: bool = True, debug: bool = False) (litmus.logging.logger)" href="../logging/#litmus.logging.logger">logger</a></code></p>


        <p>Generic class for lag fitting procedures. Contains parent methods for setting properties</p>

        <p>fitting_procedures extend the logger class and inherit all <strong>init</strong> args. See the logger documentation for details</p>
<p>The only required argument is the stat_model to perform fitting for. All other fitting parameters (listed below) can be passed as keyword arguments at init, or via .set_config(), or reset to default values with .reset().</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stat_model</code>
            </td>
            <td>
                  <code>stats_model</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Statistics model to fit for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span>
             <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
             <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    fitting_procedures extend the logger class and inherit all __init__ args. See the logger documentation for details</span>

<span class="sd">    The only required argument is the stat_model to perform fitting for. All other fitting parameters (listed below) can be passed as keyword arguments at init, or via .set_config(), or reset to default values with .reset().</span>

<span class="sd">    :param stats_model stat_model: Statistics model to fit for</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">out_stream</span><span class="o">=</span><span class="n">out_stream</span><span class="p">,</span>
                    <span class="n">err_stream</span><span class="o">=</span><span class="n">err_stream</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                    <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
                    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_default_params&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># --------------------</span>
    <span class="c1"># Attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="p">:</span> <span class="n">litmus</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">stats_model</span> <span class="o">=</span> <span class="n">stat_model</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stats model to do fitting for&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Base Fitting Procedure&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Name for string printing&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flag to see if pre-pre-fitting has been done&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">has_prefit</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flag to see if pre-fitting has been done&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flag to see if fitting procedure has run to completion&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fitting_params</span> <span class="o">=</span> <span class="p">{}</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A keyed dict of tuning parameters for the fitting method&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;seed&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fit_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="n">fit_params</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Int seed for any randomized elements in the fitting method&quot;&quot;&quot;</span>
    <span class="c1"># --------------------</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">|</span> <span class="n">fit_params</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.fitting_procedure.stat_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">stat_model</span><span class="p">:</span> <span class="n">litmus</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">stats_model</span> <span class="o">=</span> <span class="n">stat_model</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Stats model to do fitting for</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.fitting_procedure.name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Base Fitting Procedure&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Name for string printing</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.fitting_procedure.is_ready" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">is_ready</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Flag to see if pre-pre-fitting has been done</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.fitting_procedure.has_prefit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">has_prefit</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Flag to see if pre-fitting has been done</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.fitting_procedure.has_run" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">has_run</span> <span class="o">=</span> <span class="kc">False</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Flag to see if fitting procedure has run to completion</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.fitting_procedure.fitting_params" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">fitting_params</span> <span class="o">=</span> <span class="p">{}</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>A keyed dict of tuning parameters for the fitting method</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.fitting_procedure.seed" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">seed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;seed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fit_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="n">fit_params</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Int seed for any randomized elements in the fitting method</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.fitting_procedure.reset" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">reset</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Clears all memory and resets params to defaults</p>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clears all memory and resets params to defaults</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.fitting_procedure.set_config" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">set_config</span><span class="p">(</span><span class="o">**</span><span class="n">fit_params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Configure fitting parameters for fitting_method() object
Accepts any parameters present with a name in fitting_method.fitting_params
Unlisted parameters will be ignored.</p>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure fitting parameters for fitting_method() object</span>
<span class="sd">    Accepts any parameters present with a name in fitting_method.fitting_params</span>
<span class="sd">    Unlisted parameters will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Doing config with keys&quot;</span><span class="p">,</span> <span class="n">fit_params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="n">badkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">fit_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fit_params</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">fit_params</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">badkeys</span><span class="p">:</span> <span class="k">continue</span>

        <span class="c1"># If something&#39;s changed, flag as having not run</span>
        <span class="n">currval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">currval</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="c1"># self.fitting_params |= {key: val}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> set attr&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">out_stream</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">badkeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Tried to configure bad keys:&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">badkeys</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.fitting_procedure.readyup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">readyup</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Performs pre-fit preparation calcs. Should only be called if not self.is_ready()</p>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">readyup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs pre-fit preparation calcs. Should only be called if not self.is_ready()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.fitting_procedure.prefit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">prefit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Performs any tasks required after setup but prior to actual fitting</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lc_1</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="lightcurve (litmus.lightcurve.lightcurve)" href="../lightcurve/#litmus.lightcurve">lightcurve</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lightcurve 1 (Main)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lc_2</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="lightcurve (litmus.lightcurve.lightcurve)" href="../lightcurve/#litmus.lightcurve">lightcurve</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lightcurve 2 (Response)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A random seed for feeding to the fitting process. If none, will select randomly</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prefit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs any tasks required after setup but prior to actual fitting</span>
<span class="sd">    :param lc_1: Lightcurve 1 (Main)</span>
<span class="sd">    :param lc_2: Lightcurve 2 (Response)</span>
<span class="sd">    :param seed: A random seed for feeding to the fitting process. If none, will select randomly</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">has_prefit</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.fitting_procedure.fit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Performs the lag recovery method for this fitting procedure. If not prefit, will run prefit()</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lc_1</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="lightcurve (litmus.lightcurve.lightcurve)" href="../lightcurve/#litmus.lightcurve">lightcurve</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lightcurve 1 (Main)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lc_2</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="lightcurve (litmus.lightcurve.lightcurve)" href="../lightcurve/#litmus.lightcurve">lightcurve</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lightcurve 2 (Response)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A random seed for feeding to the fitting process. If none, will select randomly</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs the lag recovery method for this fitting procedure. If not prefit, will run prefit()</span>
<span class="sd">    :param lc_1: Lightcurve 1 (Main)</span>
<span class="sd">    :param lc_2: Lightcurve 2 (Response)</span>
<span class="sd">    :param seed: A random seed for feeding to the fitting process. If none, will select randomly</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Sanity checks inherited by all subclasses</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">readyup</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">lc_to_data</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="c1"># An error message raised if this fitting procedure doesn&#39;t have .fit()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">fit</span> <span class="o">==</span> <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">fit</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Fitting </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> method does not have method .fit() implemented&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.fitting_procedure.get_samples" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_samples</span><span class="p">(</span><span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns MCMC-like posterior samples if fit() has been run</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>N</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to return. If None, return all</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random seed for any stochastic elements</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>importance_sampling</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If true, will weight the results by</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>{<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>: [<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]}</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyed dict of samples in the constrained domain</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns MCMC-like posterior samples if fit() has been run</span>
<span class="sd">    :param N: Number of samples to return. If None, return all</span>
<span class="sd">    :param seed: Random seed for any stochastic elements</span>
<span class="sd">    :param importance_sampling: If true, will weight the results by</span>
<span class="sd">    :return: keyed dict of samples in the constrained domain</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">readyup</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">fit</span> <span class="o">==</span> <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">fit</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Fitting </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> method does not have method .get_samples() implemented&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.fitting_procedure.get_evidence" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_evidence</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the estimated evidence for the fit model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int seed for random number generation</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_type</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if 'linear', returns as array-like [Z, -dZ-, dZ+]. If 'log', returns as array-like [logZ, -dlogZ-, dlogZ+]</p>
              </div>
            </td>
            <td>
                  <code>&#39;linear&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>len 3 array of type [mu, -E-, E+]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_evidence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the estimated evidence for the fit model.</span>
<span class="sd">    :param seed: int seed for random number generation</span>
<span class="sd">    :param return_type: if &#39;linear&#39;, returns as array-like [Z, -dZ-, dZ+]. If &#39;log&#39;, returns as array-like [logZ, -dlogZ-, dlogZ+]</span>
<span class="sd">    :return: len 3 array of type [mu, -E-, E+]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">return_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">],</span> <span class="s2">&quot;Return type must be &#39;linear&#39; or &#39;log&#39;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">readyup</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Warning! Tried to call get_evidence without running first!&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">get_evidence</span> <span class="o">==</span> <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">get_evidence</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Fitting </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> method does not have method .get_evidence() implemented&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.fitting_procedure.get_information" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_information</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns an estimate of the information (KL divergence relative to prior). Returns as array-like [I,dI-,dI+]</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int seed for random number generation</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>len 3 array of type [mu, -E-, E+]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an estimate of the information (KL divergence relative to prior). Returns as array-like [I,dI-,dI+]</span>
<span class="sd">    :param seed: int seed for random number generation</span>
<span class="sd">    :return: len 3 array of type [mu, -E-, E+]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">readyup</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">get_information</span> <span class="o">==</span> <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">get_information</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Fitting </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> method does not have method .get_information() implemented&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.fitting_procedure.get_peaks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_peaks</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the maximum posterior position in parameter space</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int seed for random number generation</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the maximum posterior position in parameter space</span>
<span class="sd">    :param seed: int seed for random number generation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">readyup</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">get_peaks</span> <span class="o">==</span> <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Fitting </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> method does not have method .get_peaks() implemented&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{},</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.fitting_procedure.diagnostics" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">diagnostics</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Generates some plots to check if the solver has converged</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>plot</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, run plt.show()</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="litmus._types.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>generated matplotlib figure</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">diagnostics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates some plots to check if the solver has converged</span>
<span class="sd">    :param plot: If True, run plt.show()</span>
<span class="sd">    :return: generated matplotlib figure</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">diagnostics</span> <span class="o">==</span> <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">diagnostics</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Fitting </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> method does not have method .diagnostics() implemented&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.fitting_procedure.diagnostic_lagplot" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">diagnostic_lagplot</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Generates diagnostic plots specifically for lags</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>plot</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, run plt.show()</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="litmus._types.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>generated matplotlib figure</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">diagnostic_lagplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates diagnostic plots specifically for lags</span>
<span class="sd">    :param plot: If True, run plt.show()</span>
<span class="sd">    :return: generated matplotlib figure</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">diagnostic_lagplot</span> <span class="o">==</span> <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">diagnostic_lagplot</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Fitting </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> method does not have method .diagnostic_lagplot() implemented&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="litmus.fitting_methods.ICCF" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">ICCF</span><span class="p">(</span><span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span> <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="              fitting_procedure(stat_model: stats_model, out_stream=sys.stdout, err_stream=sys.stderr, verbose=True, debug=True, **fit_params) (litmus.fitting_methods.fitting_procedure)" href="#litmus.fitting_methods.fitting_procedure">fitting_procedure</a></code></p>


        <p>Fit lags using interpolated cross correlation function in the style of pyCCF.
Note that this is not a Bayesian fitter and gives only approximate measures of the lag</p>
<p>todo
    - Add p value, false positive and evidence estimates (?)</p>

        


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stat_model</code>
            </td>
            <td>
                  <code>stats_model</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Statistics model to fit for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Nboot</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bootstraps in ICCF</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Nterp</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of points to interpolate with in ICCF correlation evals</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Nlags</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of lags to test with.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span>
             <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param stats_model stat_model: Statistics model to fit for</span>
<span class="sd">    :param int Nboot: Number of bootstraps in ICCF</span>
<span class="sd">    :param int Nterp: Number of points to interpolate with in ICCF correlation evals</span>
<span class="sd">    :param int Nlags: Number of lags to test with.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">args_in</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="nb">locals</span><span class="p">(),</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">}</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;__class__&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_default_params&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">|=</span> <span class="p">{</span>
        <span class="s1">&#39;Nboot&#39;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
        <span class="s1">&#39;Nterp&#39;</span><span class="p">:</span> <span class="mi">2014</span><span class="p">,</span>
        <span class="s1">&#39;Nlags&#39;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">args_in</span><span class="p">)</span>

    <span class="c1"># --------------------</span>
    <span class="c1"># Attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ICCF Fitting Procedure&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nterp</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Array of lags to test at&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nboot</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The bootstrapped samples of the best fit lag&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">correls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nterp</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Un-bootstrapped correlation function&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lag_mean</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mean of bootstrapped best fit lags&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lag_err</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Std err of bootstrapped bestfit lags&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.ICCF.name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;ICCF Fitting Procedure&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.ICCF.lags" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nterp</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Array of lags to test at</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.ICCF.samples" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nboot</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The bootstrapped samples of the best fit lag</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.ICCF.correls" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">correls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nterp</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Un-bootstrapped correlation function</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.ICCF.lag_mean" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">lag_mean</span> <span class="o">=</span> <span class="mf">0.0</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Mean of bootstrapped best fit lags</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.ICCF.lag_err" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">lag_err</span> <span class="o">=</span> <span class="mf">0.0</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Std err of bootstrapped bestfit lags</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.ICCF.set_config" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">set_config</span><span class="p">(</span><span class="o">**</span><span class="n">fit_params</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">374</span>
<span class="normal">375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_config</span><span class="p">(</span><span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.ICCF.readyup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">readyup</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">readyup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">readyup</span><span class="p">()</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # self.lags = jnp.linspace(*self.stat_model.prior_ranges[&#39;lag&#39;], self.Nlags)</span>
<span class="sd">    self.lags = np.random.randn(self.Nlags) * self.stat_model.prior_ranges[&#39;lag&#39;].ptp() + \</span>
<span class="sd">                self.stat_model.prior_ranges[&#39;lag&#39;][0]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">has_prefit</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.ICCF.fit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># -------------------</span>

    <span class="c1"># Unpack lightcurve</span>
    <span class="n">X1</span><span class="p">,</span> <span class="n">Y1</span><span class="p">,</span> <span class="n">E1</span> <span class="o">=</span> <span class="n">lc_1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">lc_1</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">lc_1</span><span class="o">.</span><span class="n">E</span>
    <span class="n">X2</span><span class="p">,</span> <span class="n">Y2</span><span class="p">,</span> <span class="n">E2</span> <span class="o">=</span> <span class="n">lc_2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">lc_2</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">lc_2</span><span class="o">.</span><span class="n">E</span>

    <span class="c1"># Get interpolated correlation for all un-bootstrapped data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">correls</span> <span class="o">=</span> <span class="n">iccf</span><span class="o">.</span><span class="n">correlfunc_jax_vmapped</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">,</span> <span class="n">X1</span><span class="p">,</span> <span class="n">Y1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">Y2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nterp</span><span class="p">)</span>

    <span class="c1"># Do bootstrap fitting</span>
    <span class="n">lagrange</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span><span class="p">)</span>
    <span class="n">jax_samples</span> <span class="o">=</span> <span class="n">iccf</span><span class="o">.</span><span class="n">correl_func_boot_jax_wrapper_nomap</span><span class="p">(</span><span class="n">lagrange</span><span class="p">,</span> <span class="n">X1</span><span class="p">,</span> <span class="n">Y1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">Y2</span><span class="p">,</span> <span class="n">E1</span><span class="p">,</span> <span class="n">E2</span><span class="p">,</span>
                                                          <span class="n">Nterp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nterp</span><span class="p">,</span>
                                                          <span class="n">Nboot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nboot</span><span class="p">)</span>

    <span class="c1"># Store Results</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">jax_samples</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lag_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lag_err</span> <span class="o">=</span> <span class="n">jax_samples</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">jax_samples</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.ICCF.get_samples" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_samples</span><span class="p">(</span><span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}:</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>

    <span class="k">if</span> <span class="n">importance_sampling</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Warning! Cannot use important sampling with ICCF. Try implementing manually&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="c1"># -------------------</span>

    <span class="c1"># Return entire sample chain or sub-set of samples</span>
    <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">({</span><span class="s1">&#39;lag&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nboot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span>
                <span class="s2">&quot;Warning, tried to get </span><span class="si">%i</span><span class="s2"> sub-samples from </span><span class="si">%i</span><span class="s2"> boot-strap iterations in ICCF&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nboot</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="p">({</span><span class="s1">&#39;lag&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.ICCF.get_peaks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_peaks</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">({</span><span class="nb">float</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]},</span> <span class="p">[</span><span class="nb">float</span><span class="p">])</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">({</span><span class="nb">float</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]},</span> <span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># --------------</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">correls</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;lag&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">out</span><span class="p">])}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="litmus.fitting_methods.prior_sampling" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">prior_sampling</span><span class="p">(</span><span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span> <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="              fitting_procedure(stat_model: stats_model, out_stream=sys.stdout, err_stream=sys.stderr, verbose=True, debug=True, **fit_params) (litmus.fitting_methods.fitting_procedure)" href="#litmus.fitting_methods.fitting_procedure">fitting_procedure</a></code></p>


        <p>Randomly samples from the prior and weights with importance sampling.
The crudest available sampler. For test purposes only, not suggested for actual use.</p>

        


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stat_model</code>
            </td>
            <td>
                  <code>stats_model</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Statistics model to fit for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Nsamples</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to draw from the prior. Defaults to 4096.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span>
             <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param stats_model stat_model: Statistics model to fit for</span>
<span class="sd">    :param stats_model stat_model: Statistics model to fit for</span>
<span class="sd">    :param int Nsamples: Number of samples to draw from the prior. Defaults to 4096.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ------------------------------------</span>
    <span class="n">args_in</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="nb">locals</span><span class="p">(),</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">}</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;__class__&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_default_params&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">|=</span> <span class="p">{</span>
        <span class="s1">&#39;Nsamples&#39;</span><span class="p">:</span> <span class="mi">4096</span>
    <span class="p">}</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">args_in</span><span class="p">)</span>
    <span class="c1"># --------------------</span>
    <span class="c1"># Attributes</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Prior Sampling Fitting Procedure&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">()}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Samples drawn from the prior&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log prior densities of the samples&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_likes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log likelihood of the samples&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log joint density of the samples&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalized weights for drawing the samples&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.prior_sampling.name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Prior Sampling Fitting Procedure&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.prior_sampling.samples" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">samples</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">()}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Samples drawn from the prior</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.prior_sampling.log_prior" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">log_prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Log prior densities of the samples</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.prior_sampling.log_likes" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">log_likes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Log likelihood of the samples</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.prior_sampling.log_density" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">log_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Log joint density of the samples</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.prior_sampling.weights" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Normalized weights for drawing the samples</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.prior_sampling.fit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># -------------------</span>

    <span class="c1"># Generate samples &amp; calculate likelihoods todo - These currently give posterior densities and not log likes</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">lc_to_data</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">)</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_sample</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">log_density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">samples</span><span class="p">)</span>
    <span class="n">log_prior</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_prior</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">samples</span><span class="p">)</span>
    <span class="n">log_likes</span> <span class="o">=</span> <span class="n">log_density</span> <span class="o">-</span> <span class="n">log_prior</span>
    <span class="n">likes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_likes</span><span class="p">)</span>

    <span class="c1"># Store results</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_prior</span> <span class="o">=</span> <span class="n">log_prior</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_likes</span> <span class="o">=</span> <span class="n">log_likes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_density</span> <span class="o">=</span> <span class="n">log_density</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">likes</span> <span class="o">/</span> <span class="n">likes</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Mark as having completed a run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.prior_sampling.get_samples" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_samples</span><span class="p">(</span><span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}:</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># -------------------</span>

    <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Warning, tried to get </span><span class="si">%i</span><span class="s2"> sub-samples from </span><span class="si">%i</span><span class="s2"> samples&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">importance_sampling</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">p</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">({</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">val</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.prior_sampling.get_evidence" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_evidence</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_evidence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">get_evidence</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># -------------------</span>
    <span class="n">density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_density</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_density</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="n">Z</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_volume</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_density</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">uncert</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_volume</span>

    <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Z</span><span class="p">,</span> <span class="o">-</span><span class="n">uncert</span><span class="p">,</span> <span class="n">uncert</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">uncert</span> <span class="o">/</span> <span class="n">Z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">uncert</span> <span class="o">/</span> <span class="n">Z</span><span class="p">)])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.prior_sampling.get_information" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_information</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">get_information</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># -------------------</span>
    <span class="n">info_partial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_density</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prior</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">,</span>
                                    <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">info_partial</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_volume</span>
    <span class="n">uncert</span> <span class="o">=</span> <span class="n">info_partial</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsamples</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_volume</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">info</span><span class="p">,</span> <span class="o">-</span><span class="n">uncert</span><span class="p">,</span> <span class="n">uncert</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="litmus.fitting_methods.nested_sampling" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">nested_sampling</span><span class="p">(</span><span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span> <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="              fitting_procedure(stat_model: stats_model, out_stream=sys.stdout, err_stream=sys.stderr, verbose=True, debug=True, **fit_params) (litmus.fitting_methods.fitting_procedure)" href="#litmus.fitting_methods.fitting_procedure">fitting_procedure</a></code></p>


        <p>Fits the Bayesian model with Nested Sampling by using JAXNS. Highly accurate evidence / posterior distributions,
but can be slow for models with more than a few parameters. Use only if hessian_scan and SVI_scan fail.</p>

        


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stat_model</code>
            </td>
            <td>
                  <code>stats_model</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Statistics model to fit for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_live_points</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of live points to use in nested sampling fitting. Defaults to 500.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_samples</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum samples before terminating the run. Defaults to 10_000.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_parallel_samplers</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of parallel samplers to fit with. Defaults to 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>evidence_uncert</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Termination condition for evidence uncertainty. Default to 1E-3.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>live_evidence_frac</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Termination condition for live fraction of evidence remaining. Defaults to log(1 + 1e-3).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span>
             <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param stats_model stat_model: Statistics model to fit for</span>
<span class="sd">    :param int num_live_points: Number of live points to use in nested sampling fitting. Defaults to 500.</span>
<span class="sd">    :param int max_samples: Maximum samples before terminating the run. Defaults to 10_000.</span>
<span class="sd">    :param int num_parallel_samplers: Number of parallel samplers to fit with. Defaults to 1.</span>
<span class="sd">    :param float evidence_uncert: Termination condition for evidence uncertainty. Default to 1E-3.</span>
<span class="sd">    :param float live_evidence_frac: Termination condition for live fraction of evidence remaining. Defaults to log(1 + 1e-3).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">args_in</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="nb">locals</span><span class="p">(),</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">}</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;__class__&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_default_params&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">|=</span> <span class="p">{</span>
        <span class="s1">&#39;num_live_points&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
        <span class="s1">&#39;max_samples&#39;</span><span class="p">:</span> <span class="mi">10_000</span><span class="p">,</span>
        <span class="s1">&#39;num_parallel_samplers&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;evidence_uncert&#39;</span><span class="p">:</span> <span class="mf">1E-3</span><span class="p">,</span>
        <span class="s1">&#39;live_evidence_frac&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">1e-3</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">args_in</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsmodel</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsresults</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnstermination</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsresults</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># --------------------</span>
    <span class="c1"># Attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Nested Sampling Fitting Procedure&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The JAXNS nested sampler object&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logevidence</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;JAXNS log evidence&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">priorvolume</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prior volume for correcting from unit cube to actual density&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.nested_sampling.name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Nested Sampling Fitting Procedure&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.nested_sampling.sampler" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">sampler</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The JAXNS nested sampler object</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.nested_sampling.logevidence" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">logevidence</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>JAXNS log evidence</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.nested_sampling.priorvolume" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">priorvolume</span> <span class="o">=</span> <span class="mf">0.0</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Prior volume for correcting from unit cube to actual density</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.nested_sampling.prefit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">prefit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prefit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># ---------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">prefit</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>
    <span class="c1"># ---------------------</span>

    <span class="c1"># Get uniform prior bounds</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">()])</span>
    <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bounds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bounds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">lc_to_data</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">)</span>

    <span class="c1"># Construct jaxns friendly prior &amp; likelihood</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">prior_model</span><span class="p">():</span>
        <span class="n">x</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">jaxns</span><span class="o">.</span><span class="n">Prior</span><span class="p">(</span><span class="n">tfpd</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">lo</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">hi</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_unpack</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">())</span>
        <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="n">hide</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">()):</span>
            <span class="n">LL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">_log_likelihood</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">LL</span>

    <span class="c1"># jaxns object setup</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsmodel</span> <span class="o">=</span> <span class="n">jaxns</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">prior_model</span><span class="o">=</span><span class="n">prior_model</span><span class="p">,</span>
                                   <span class="n">log_likelihood</span><span class="o">=</span><span class="n">log_likelihood</span><span class="p">,</span>
                                   <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnstermination</span> <span class="o">=</span> <span class="n">jaxns</span><span class="o">.</span><span class="n">TerminationCondition</span><span class="p">(</span>
        <span class="n">dlogZ</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evidence_uncert</span><span class="p">,</span>
        <span class="n">max_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_samples</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Build jaxns Nested Sampler</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">jaxns</span><span class="o">.</span><span class="n">NestedSampler</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsmodel</span><span class="p">,</span>
        <span class="n">max_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_samples</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
        <span class="n">num_live_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_live_points</span><span class="p">,</span>
        <span class="n">num_parallel_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_parallel_samplers</span><span class="p">,</span>
        <span class="n">difficult_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">has_prefit</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.nested_sampling.fit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># ---------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>
    <span class="c1"># ---------------------</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_prefit</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">readyup</span><span class="p">()</span>
    <span class="c1"># ---------------------</span>

    <span class="c1"># -----------------</span>
    <span class="c1"># Run the sampler!</span>
    <span class="n">termination_reason</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">seed</span><span class="p">),</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnstermination</span><span class="p">)</span>

    <span class="c1"># -----------------</span>
    <span class="c1"># Extract &amp; save results</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsresults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">to_results</span><span class="p">(</span>
        <span class="n">termination_reason</span><span class="o">=</span><span class="n">termination_reason</span><span class="p">,</span>
        <span class="n">state</span><span class="o">=</span><span class="n">state</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.nested_sampling.get_samples" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_samples</span><span class="p">(</span><span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}:</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>

    <span class="n">samples</span><span class="p">,</span> <span class="n">logweights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsresults</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsresults</span><span class="o">.</span><span class="n">log_dp_mean</span>

    <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">importance_sampling</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">samples</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">())}</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">importance_sampling</span><span class="p">:</span>
        <span class="n">logweights</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">logweights</span><span class="p">)</span>

    <span class="n">samples</span> <span class="o">=</span> <span class="n">jaxns</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">seed</span><span class="p">),</span>
        <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span>
        <span class="n">log_weights</span><span class="o">=</span><span class="n">logweights</span><span class="p">,</span>
        <span class="n">S</span><span class="o">=</span><span class="n">N</span>
    <span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">samples</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">())}</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.nested_sampling.get_evidence" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_evidence</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the -1, 0 and +1 sigma values for model evidence from nested sampling.
This represents an estimate of numerical uncertainty</p>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_evidence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the -1, 0 and +1 sigma values for model evidence from nested sampling.</span>
<span class="sd">    This represents an estimate of numerical uncertainty</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>

    <span class="n">l</span><span class="p">,</span> <span class="n">l_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsresults</span><span class="o">.</span><span class="n">log_Z_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsresults</span><span class="o">.</span><span class="n">log_Z_uncert</span>

    <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">([</span>
            <span class="n">l</span><span class="p">,</span>
            <span class="n">l</span> <span class="o">-</span> <span class="n">l_e</span><span class="p">,</span>
            <span class="n">l</span> <span class="o">+</span> <span class="n">l_e</span>
        <span class="p">])</span>

        <span class="n">out</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l_e</span><span class="p">,</span> <span class="n">l_e</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span>
            <span class="s2">&quot;Warning! Tried to call get_evidence in </span><span class="si">%s</span><span class="s2"> with bad return_type. Should be &#39;log&#39; or &#39;linear&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.nested_sampling.get_information" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_information</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Use the Nested Sampling shells to estimate the model information relative to prior</p>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the Nested Sampling shells to estimate the model information relative to prior</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># todo - this is outmoded</span>

    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>

    <span class="n">samples</span><span class="p">,</span> <span class="n">logweights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsresults</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsresults</span><span class="o">.</span><span class="n">log_dp_mean</span>

    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logweights</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">/=</span> <span class="n">weights</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">log_density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsresults</span><span class="o">.</span><span class="n">log_posterior_density</span>
    <span class="n">prior_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_prior</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>

    <span class="n">info</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">log_density</span> <span class="o">-</span> <span class="n">prior_values</span><span class="p">)</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span>

    <span class="n">partial_info</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="n">log_density</span> <span class="o">-</span> <span class="n">prior_values</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_density</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">uncert</span> <span class="o">=</span> <span class="n">partial_info</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log_density</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">uncert</span><span class="p">,</span> <span class="n">uncert</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.nested_sampling.get_peaks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_peaks</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">({</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]},</span> <span class="nb">float</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_peaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">({</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]},</span> <span class="nb">float</span><span class="p">):</span>

    <span class="c1"># todo - this is outmoded</span>

    <span class="c1"># ---------------------</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">randint</span><span class="p">()</span>
    <span class="c1"># ---------------------</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;get_peaks currently placeholder.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">()},</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>

    <span class="c1"># ---------------------</span>

    <span class="n">NS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>
    <span class="n">log_densities</span> <span class="o">=</span> <span class="n">NS</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">log_posterior_density</span>

    <span class="c1"># Find clusters</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">clustering</span><span class="o">.</span><span class="n">clusterfind_1D</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">])</span>

    <span class="c1"># Break samples and log-densities up into clusters</span>
    <span class="n">sorted_samples</span> <span class="o">=</span> <span class="n">clustering</span><span class="o">.</span><span class="n">sort_by_cluster</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
    <span class="n">sort_logdens</span> <span class="o">=</span> <span class="n">clustering</span><span class="o">.</span><span class="n">sort_by_cluster</span><span class="p">(</span><span class="n">log_densities</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>

    <span class="n">Nclusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_samples</span><span class="p">)</span>

    <span class="c1"># Make an empty dictionary to store positions in</span>
    <span class="n">peak_locations</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nclusters</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="n">peaklikes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nclusters</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">lds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_samples</span><span class="p">,</span> <span class="n">sort_logdens</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">lds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">samples</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">peak_locations</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
        <span class="n">peaklikes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lds</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">peak_locations</span><span class="p">,</span> <span class="n">peaklikes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.nested_sampling.diagnostics" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">diagnostics</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">diagnostics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>

    <span class="c1"># todo fix this to make the show work properly</span>
    <span class="n">jaxns</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jaxnsresults</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="litmus.fitting_methods.hessian_scan" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">hessian_scan</span><span class="p">(</span><span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span> <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="              fitting_procedure(stat_model: stats_model, out_stream=sys.stdout, err_stream=sys.stderr, verbose=True, debug=True, **fit_params) (litmus.fitting_methods.fitting_procedure)" href="#litmus.fitting_methods.fitting_procedure">fitting_procedure</a></code></p>


        <p>Litmus's main hessian scan fitting procedure.</p>

        


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>stat_model</code>
            </td>
            <td>
                  <code>stats_model</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Statistics model to fit for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Nlags&#39;</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>64</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>opt_tol&#39;</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1E-2</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>opt_tol_init&#39;</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1E-4</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step_size&#39;</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>0.001</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>constrained_domain&#39;</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>False</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_opt_eval&#39;</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1_000</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_opt_eval_init&#39;</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>5_000</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>LL_threshold&#39;</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>100.0</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>init_samples&#39;</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>5_000</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grid_bunching&#39;</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amount to bunch up points about peaks in grid smoothing, with 0.0 being even spacing and 1.0 being MCMC_like sample spacing. Defaults to 0.5.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grid_depth&#39;</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grid_Nterp&#39;</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grid_relaxation&#39;</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>0.1,  # deprecated, remove</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grid_firstdepth&#39;</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2.0</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reverse&#39;</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defaults to True.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>split_lags&#39;</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defaults to True.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer_args_init&#39;</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>{}</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer_args&#39;</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>{}</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed_params&#39;</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>{}</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>precondition&#39;</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of preconditioning to use in scan. Defaults to 'diag'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interp_scale&#39;</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scale to peform grid smoothing interpolation on . Defaults to 'log'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span>
             <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param stats_model stat_model: Statistics model to fit for</span>
<span class="sd">    :param int Nlags&#39;: 64</span>
<span class="sd">    :param float opt_tol&#39;: 1E-2</span>
<span class="sd">    :param float opt_tol_init&#39;: 1E-4</span>
<span class="sd">    :param float step_size&#39;: 0.001</span>
<span class="sd">    :param bool constrained_domain&#39;: False</span>
<span class="sd">    :param int max_opt_eval&#39;: 1_000</span>
<span class="sd">    :param int max_opt_eval_init&#39;: 5_000</span>
<span class="sd">    :param float LL_threshold&#39;: 100.0</span>
<span class="sd">    :param int init_samples&#39;: 5_000</span>
<span class="sd">    :param float grid_bunching&#39;: Amount to bunch up points about peaks in grid smoothing, with 0.0 being even spacing and 1.0 being MCMC_like sample spacing. Defaults to 0.5.</span>
<span class="sd">    :param grid_depth&#39;: None</span>
<span class="sd">    :param grid_Nterp&#39;: None</span>
<span class="sd">    :param float grid_relaxation&#39;: 0.1,  # deprecated, remove</span>
<span class="sd">    :param float grid_firstdepth&#39;: 2.0</span>
<span class="sd">    :param bool reverse&#39;: Defaults to True.</span>
<span class="sd">    :param bool split_lags&#39;: Defaults to True.</span>
<span class="sd">    :param dict optimizer_args_init&#39;: {}</span>
<span class="sd">    :param dict optimizer_args&#39;: {}</span>
<span class="sd">    :param dict seed_params&#39;: {}</span>
<span class="sd">    :param str precondition&#39;: Type of preconditioning to use in scan. Defaults to &#39;diag&#39;.</span>
<span class="sd">    :param str interp_scale&#39;: Scale to peform grid smoothing interpolation on . Defaults to &#39;log&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args_in</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="nb">locals</span><span class="p">(),</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">}</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;__class__&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_default_params&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">|=</span> <span class="p">{</span>
        <span class="s1">&#39;Nlags&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
        <span class="s1">&#39;opt_tol&#39;</span><span class="p">:</span> <span class="mf">1E-2</span><span class="p">,</span>
        <span class="s1">&#39;opt_tol_init&#39;</span><span class="p">:</span> <span class="mf">1E-4</span><span class="p">,</span>
        <span class="s1">&#39;step_size&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
        <span class="s1">&#39;constrained_domain&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;max_opt_eval&#39;</span><span class="p">:</span> <span class="mi">1_000</span><span class="p">,</span>
        <span class="s1">&#39;max_opt_eval_init&#39;</span><span class="p">:</span> <span class="mi">5_000</span><span class="p">,</span>
        <span class="s1">&#39;LL_threshold&#39;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>
        <span class="s1">&#39;init_samples&#39;</span><span class="p">:</span> <span class="mi">5_000</span><span class="p">,</span>
        <span class="s1">&#39;grid_bunching&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s1">&#39;grid_depth&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;grid_Nterp&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;grid_relaxation&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># deprecated, remove</span>
        <span class="s1">&#39;grid_firstdepth&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
        <span class="s1">&#39;reverse&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;split_lags&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;optimizer_args_init&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;optimizer_args&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;seed_params&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;precondition&#39;</span><span class="p">:</span> <span class="s1">&#39;diag&#39;</span><span class="p">,</span>
        <span class="s1">&#39;interp_scale&#39;</span><span class="p">:</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_allowable_interpscales</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">]</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">args_in</span><span class="p">)</span>

    <span class="c1"># -----------------------------------</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Hessian Scan Fitting Procedure&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">scan_peaks</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_evidences</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_evidences_uncert</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_hessians</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_densities</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_grads</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_ints</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_tgrads</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">free_params</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;lag&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;lag&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">precon_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="p">:</span> <span class="n">jaxopt</span><span class="o">.</span><span class="n">BFGS</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Hessian Scan Fitting Procedure&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.lags" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">lags</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.converged" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">converged</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.scan_peaks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">scan_peaks</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.log_evidences" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">log_evidences</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.log_evidences_uncert" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">log_evidences_uncert</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.diagnostic_hessians" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">diagnostic_hessians</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.diagnostic_densities" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">diagnostic_densities</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.diagnostic_grads" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">diagnostic_grads</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.diagnostic_ints" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">diagnostic_ints</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.diagnostic_tgrads" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">diagnostic_tgrads</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.params_toscan" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">params_toscan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">free_params</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.precon_matrix" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">precon_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.solver" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">solver</span><span class="p">:</span> <span class="n">jaxopt</span><span class="o">.</span><span class="n">BFGS</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.hessian_scan.estmap_params" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">estmap_params</span> <span class="o">=</span> <span class="p">{}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.hessian_scan.readyup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">readyup</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">readyup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="c1"># Get grid properties</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_relaxation</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_Nterp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_Nterp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span> <span class="o">*</span> <span class="mi">10</span>

    <span class="c1"># Make list of lags for scanning</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">converged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="n">free_dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">free_params</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scan_peaks</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">()}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_hessians</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_grads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_densities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_evidences_uncert</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">()</span> <span class="k">if</span>
                          <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">free_params</span><span class="p">()</span>
                          <span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.hessian_scan.estimate_MAP" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">estimate_MAP</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lc_1</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="lightcurve (litmus.lightcurve.lightcurve)" href="../lightcurve/#litmus.lightcurve">lightcurve</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lc_2</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="lightcurve (litmus.lightcurve.lightcurve)" href="../lightcurve/#litmus.lightcurve">lightcurve</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">estimate_MAP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param lc_1:</span>
<span class="sd">    :param lc_2:</span>
<span class="sd">    :param seed:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">lc_to_data</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">)</span>

    <span class="c1"># ----------------------------------</span>
    <span class="c1"># Find seed for optimization if not supplies</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">free_params</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">seed_params</span><span class="p">,</span> <span class="n">ll_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">find_seed</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">guesses</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">init_samples</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Beginning scan at constrained-space position:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">seed_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="se">\t</span><span class="s1"> </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span>
            <span class="s2">&quot;Log-Density for this is: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ll_start</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">seed_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_params</span>
        <span class="n">ll_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="n">seed_params</span><span class="p">,</span>
                                               <span class="n">data</span><span class="o">=</span><span class="n">data</span>
                                               <span class="p">)</span>

    <span class="c1"># ----------------------------------</span>
    <span class="c1"># SCANNING FOR OPT</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Moving non-lag params to new location...&quot;</span><span class="p">)</span>
    <span class="n">estmap_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">seed_params</span><span class="p">,</span>
                                         <span class="n">optim_params</span><span class="o">=</span><span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">free_params</span><span class="p">()</span> <span class="k">if</span>
                                                       <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;lag&#39;</span><span class="p">],</span>
                                         <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                         <span class="n">optim_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer_args_init</span><span class="p">,</span>
                                         <span class="n">precondition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precondition</span>
                                         <span class="p">)</span>
    <span class="n">ll_firstscan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="n">estmap_params</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;lag&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">free_params</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Optimizer settled at new fit:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">estmap_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="se">\t</span><span class="s1"> </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span>
            <span class="s2">&quot;Log-Density for this is: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ll_firstscan</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Finding a good lag...&quot;</span><span class="p">)</span>
        <span class="n">test_lags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_samples</span><span class="p">)[</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span>
        <span class="n">test_samples</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_extend</span><span class="p">(</span><span class="n">estmap_params</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;lag&#39;</span><span class="p">:</span> <span class="n">test_lags</span><span class="p">})</span>
        <span class="n">ll_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="n">test_samples</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">bestlag</span> <span class="o">=</span> <span class="n">test_lags</span><span class="p">[</span><span class="n">ll_test</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Grid finds good lag at </span><span class="si">%.2f</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="n">bestlag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span>
            <span class="s2">&quot;Log-Density for this is: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ll_test</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">ll_test</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">ll_firstscan</span><span class="p">:</span>
            <span class="n">bestlag</span> <span class="o">=</span> <span class="n">bestlag</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bestlag</span> <span class="o">=</span> <span class="n">estmap_params</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span>

        <span class="n">estmap_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">estmap_params</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;lag&#39;</span><span class="p">:</span> <span class="n">bestlag</span><span class="p">},</span>
                                             <span class="n">optim_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">],</span>
                                             <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                             <span class="n">optim_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer_args_init</span><span class="p">,</span>
                                             <span class="n">precondition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precondition</span>
                                             <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Lag-only opt settled at new lag </span><span class="si">%.2f</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">estmap_params</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">])</span>

    <span class="n">ll_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="n">estmap_params</span><span class="p">,</span>
                                         <span class="n">data</span><span class="o">=</span><span class="n">data</span>
                                         <span class="p">)</span>

    <span class="c1"># ----------------------------------</span>
    <span class="c1"># CHECKING OUTPUTS</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Optimizer settled at new fit:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">estmap_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> </span><span class="si">%s</span><span class="s1">: </span><span class="se">\t</span><span class="s1"> </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span>
        <span class="s2">&quot;Log-Density for this is: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ll_end</span>
    <span class="p">)</span>

    <span class="c1"># ----------------------------------</span>
    <span class="c1"># CHECKING OUTPUTS</span>

    <span class="k">if</span> <span class="n">ll_end</span> <span class="o">&lt;</span> <span class="n">ll_start</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Warning! Optimization seems to have diverged. Defaulting to seed params. </span><span class="se">\n</span><span class="s2">&quot;</span>
                     <span class="s2">&quot;Please consider running with different optim_init inputs&quot;</span><span class="p">)</span>
        <span class="n">estmap_params</span> <span class="o">=</span> <span class="n">seed_params</span>
    <span class="k">return</span> <span class="n">estmap_params</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.hessian_scan.make_grid" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">make_grid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">seed_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interp_scale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">ArrayN</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Generates a grid of test lags for use in the hessian scan via the grid smoothing algorithm listed in the paper</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>data to condition the model on</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed_params</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An initial guess for the seed parameters formed by common sense. If None or incomplete, is filled using the statmodels find_seed method.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interp_scale</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What scale to perform interpolation between the test lags at, 'log' or 'linear'</p>
              </div>
            </td>
            <td>
                  <code>&#39;log&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="            ArrayN = Annotated[NDArray[DType], Literal['N']]

  
      module-attribute
   (litmus._types.ArrayN)" href="../_utils/#litmus._types.ArrayN">ArrayN</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of lags of len self.Nlags</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">seed_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interp_scale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">ArrayN</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a grid of test lags for use in the hessian scan via the grid smoothing algorithm listed in the paper</span>
<span class="sd">    :param data: data to condition the model on</span>
<span class="sd">    :param seed_params: An initial guess for the seed parameters formed by common sense. If None or incomplete, is filled using the statmodels find_seed method.</span>
<span class="sd">    :param interp_scale: What scale to perform interpolation between the test lags at, &#39;log&#39; or &#39;linear&#39;</span>
<span class="sd">    :return: Array of lags of len self.Nlags</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">interp_scale</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">],</span> <span class="s2">&quot;Interp scale was </span><span class="si">%s</span><span class="s2">, must be in &#39;log&#39; or &#39;linear&#39;&quot;</span> <span class="o">%</span> <span class="n">interp_scale</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">readyup</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;lag&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">fixed_params</span><span class="p">():</span>
        <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readyup</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">lags</span>

    <span class="c1"># If no seed parameters specified, use stored</span>
    <span class="k">if</span> <span class="n">seed_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">seed_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span>

    <span class="c1"># If these params are incomplete, use find_seed to complete them</span>
    <span class="k">if</span> <span class="n">seed_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">():</span>
        <span class="n">seed_params</span><span class="p">,</span> <span class="n">llstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">find_seed</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">guesses</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">init_samples</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="n">seed_params</span><span class="p">)</span>

    <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_firstdepth</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">lag_terp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_Nterp</span><span class="p">)</span>

    <span class="n">log_density_all</span><span class="p">,</span> <span class="n">lags_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_depth</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_extend</span><span class="p">(</span><span class="n">seed_params</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;lag&#39;</span><span class="p">:</span> <span class="n">lags</span><span class="p">})</span>
        <span class="n">log_density_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">log_density_all</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="p">)])</span>
        <span class="n">lags_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lags_all</span><span class="p">,</span> <span class="n">lags</span><span class="p">])</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">lags_all</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
        <span class="n">log_density_all</span><span class="p">,</span> <span class="n">lags_all</span> <span class="o">=</span> <span class="n">log_density_all</span><span class="p">[</span><span class="n">I</span><span class="p">],</span> <span class="n">lags_all</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">interp_scale</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>

            <span class="n">density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_density_all</span> <span class="o">-</span> <span class="n">log_density_all</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="c1"># Linearly interpolate the density profile</span>
            <span class="n">density_terp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lag_terp</span><span class="p">,</span> <span class="n">lags_all</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">density_terp</span> <span class="o">/=</span> <span class="n">density_terp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>


        <span class="k">elif</span> <span class="n">interp_scale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>

            <span class="n">density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_density_all</span> <span class="o">-</span> <span class="n">log_density_all</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="c1"># Linearly interpolate the density profile</span>
            <span class="n">log_density_terp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lag_terp</span><span class="p">,</span> <span class="n">log_density_all</span> <span class="o">-</span> <span class="n">log_density_all</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">density</span><span class="p">,</span>
                                         <span class="n">left</span><span class="o">=</span><span class="n">log_density_all</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">log_density_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">density_terp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_density_terp</span><span class="p">)</span>
            <span class="n">density_terp</span> <span class="o">/=</span> <span class="n">density_terp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">gets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_Nterp</span><span class="p">)</span>
        <span class="n">percentiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">density_terp</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_bunching</span> <span class="o">+</span> <span class="n">gets</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_bunching</span><span class="p">)</span>
        <span class="n">percentiles</span> <span class="o">/=</span> <span class="n">percentiles</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span><span class="p">),</span> <span class="n">percentiles</span><span class="p">,</span> <span class="n">lag_terp</span><span class="p">,</span>
                         <span class="n">left</span><span class="o">=</span><span class="n">lag_terp</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                         <span class="n">right</span><span class="o">=</span><span class="n">lag_terp</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                         <span class="p">)</span>

    <span class="k">return</span> <span class="n">lags</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.hessian_scan.prefit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">prefit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prefit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">prefit</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># -------------------</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">lc_to_data</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">)</span>

    <span class="c1"># ----------------------------------</span>
    <span class="c1"># Estimate the MAP</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_MAP</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">estmap_tol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">opt_tol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                              <span class="n">integrate_axes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">free_params</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Estimated to be within </span><span class="si">%.2e</span><span class="s2"> of local optimum&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">estmap_tol</span><span class="p">)</span>
    <span class="c1"># ----------------------------------</span>

    <span class="c1"># Make a grid</span>

    <span class="n">lags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_grid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">seed_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_lags</span><span class="p">:</span>
        <span class="n">split_index</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lags</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
        <span class="n">lags_left</span><span class="p">,</span> <span class="n">lags_right</span> <span class="o">=</span> <span class="n">lags</span><span class="p">[:</span><span class="n">split_index</span><span class="p">],</span> <span class="n">lags</span><span class="p">[</span><span class="n">split_index</span><span class="p">:]</span>
        <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lags_right</span><span class="p">,</span> <span class="n">lags_left</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="n">lags</span> <span class="o">=</span> <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lags_left</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lags_right</span><span class="p">])</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span>
        <span class="n">lags</span> <span class="o">=</span> <span class="n">lags</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">lags</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">has_prefit</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.hessian_scan.fit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># -------------------</span>
    <span class="c1"># Setup + prefit if not run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Starting Hessian Scan&quot;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">lc_to_data</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_prefit</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
    <span class="n">best_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># ----------------------------------</span>
    <span class="c1"># Create scanner and perform setup</span>
    <span class="n">params_toscan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span>
    <span class="n">lags_forscan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">solver</span><span class="p">,</span> <span class="n">runsolver</span><span class="p">,</span> <span class="p">[</span><span class="n">converter</span><span class="p">,</span> <span class="n">deconverter</span><span class="p">,</span> <span class="n">optfunc</span><span class="p">,</span> <span class="n">runsolver_jit</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">_scanner</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
                                                                                                   <span class="n">optim_params</span><span class="o">=</span><span class="n">params_toscan</span><span class="p">,</span>
                                                                                                   <span class="n">optim_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer_args</span><span class="p">,</span>
                                                                                                   <span class="n">return_aux</span><span class="o">=</span><span class="kc">True</span>
                                                                                                   <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">solver</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">converter</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">init_state</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="c1"># ----------------------------------</span>
    <span class="c1"># Sweep over lags</span>
    <span class="n">scanned_optima</span><span class="p">,</span> <span class="n">grads</span><span class="p">,</span> <span class="n">Hs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">tols</span><span class="p">,</span> <span class="n">Zs</span><span class="p">,</span> <span class="n">Ints</span><span class="p">,</span> <span class="n">tgrads</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lags_forscan</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;:&quot;</span> <span class="o">*</span> <span class="mi">23</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Scanning at lag=</span><span class="si">%.2f</span><span class="s2"> ...&quot;</span> <span class="o">%</span> <span class="n">lag</span><span class="p">)</span>

        <span class="c1"># Get current param site in packed-function friendly terms</span>
        <span class="n">opt_params</span><span class="p">,</span> <span class="n">aux_data</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">runsolver_jit</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">best_params</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;lag&#39;</span><span class="p">:</span> <span class="n">lag</span><span class="p">},</span> <span class="n">state</span><span class="p">)</span>

        <span class="c1"># --------------</span>
        <span class="c1"># Check if the optimization has succeeded or broken</span>

        <span class="n">l_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="n">best_params</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;lag&#39;</span><span class="p">:</span> <span class="n">lag</span><span class="p">},</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">l_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="n">opt_params</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;lag&#39;</span><span class="p">:</span> <span class="n">lag</span><span class="p">},</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">bigdrop</span> <span class="o">=</span> <span class="n">l_2</span> <span class="o">-</span> <span class="n">l_1</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">LL_threshold</span>
        <span class="n">diverged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">to_uncon</span><span class="p">(</span><span class="n">opt_params</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()])))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Change of </span><span class="si">%.2f</span><span class="s2"> against </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">l_2</span> <span class="o">-</span> <span class="n">l_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">LL_threshold</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bigdrop</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">diverged</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">converged</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">is_good</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

            <span class="c1"># ======</span>
            <span class="c1"># Check position &amp; Grad</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">uncon_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">to_uncon</span><span class="p">(</span><span class="n">opt_params</span><span class="p">)</span>
                <span class="n">log_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density_uncon</span><span class="p">(</span><span class="n">uncon_params</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Something wrong!&quot;</span><span class="p">)</span>
                <span class="n">is_good</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># ======</span>
            <span class="c1"># Check tolerances &amp; hessians</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density_uncon_hess</span><span class="p">(</span><span class="n">uncon_params</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">params_toscan</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="s2">&quot;Error in H calc&quot;</span>
                <span class="n">tol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">opt_tol</span><span class="p">(</span><span class="n">opt_params</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">integrate_axes</span><span class="o">=</span><span class="n">params_toscan</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Something wrong in Hessian / Tolerance!:&quot;</span><span class="p">)</span>
                <span class="n">is_good</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># ======</span>
            <span class="c1"># Get evidence</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">laplace_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">laplace_log_evidence</span><span class="p">(</span><span class="n">opt_params</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                                   <span class="n">integrate_axes</span><span class="o">=</span><span class="n">params_toscan</span><span class="p">,</span>
                                                                   <span class="n">constrained</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constrained_domain</span><span class="p">)</span>
                <span class="n">tgrad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">uncon_grad_lag</span><span class="p">(</span><span class="n">opt_params</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">constrained_domain</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">laplace_int</span> <span class="o">+</span> <span class="n">tgrad</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span> <span class="s2">&quot;Error in Z calc&quot;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Something wrong in Evidence!:&quot;</span><span class="p">)</span>
                <span class="n">is_good</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Check and save if good</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">is_good</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span>
                    <span class="s2">&quot;Seems to have converged at iteration </span><span class="si">%i</span><span class="s2"> / </span><span class="si">%i</span><span class="s2"> with tolerance </span><span class="si">%.2e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span><span class="p">,</span> <span class="n">tol</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">tol</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                    <span class="n">best_params</span> <span class="o">=</span> <span class="n">opt_params</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Possibly stuck in a furrow. Resetting start params&quot;</span><span class="p">)</span>
                    <span class="n">best_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="n">scanned_optima</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opt_params</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
                <span class="n">tols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tol</span><span class="p">)</span>

                <span class="n">grads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aux_data</span><span class="p">[</span><span class="s1">&#39;grad&#39;</span><span class="p">])</span>
                <span class="n">Hs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
                <span class="n">Ints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">laplace_int</span><span class="p">)</span>
                <span class="n">tgrads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tgrad</span><span class="p">)</span>
                <span class="n">Zs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Seems to have severely diverged at iteration </span><span class="si">%i</span><span class="s2"> / </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span><span class="p">))</span>
                <span class="n">reason</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Eval&quot;</span><span class="p">,</span> <span class="s2">&quot;hessian/tol&quot;</span><span class="p">,</span> <span class="s2">&quot;evidence&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">reason</span><span class="p">,</span> <span class="n">is_good</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="se">\t</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">converged</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Unable to converge at iteration </span><span class="si">%i</span><span class="s2"> / </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span><span class="p">),</span>
                         <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Large Drop?:</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">bigdrop</span><span class="p">,</span>
                         <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Optimizer Diverged:</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">diverged</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converged</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;All slices catastrophically diverged! Try different starting conditions and/or grid spacing&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Scanning Complete. Calculating laplace integrals...&quot;</span><span class="p">)</span>

    <span class="c1"># --------</span>
    <span class="c1"># Save and apply</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_grads</span> <span class="o">=</span> <span class="n">grads</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_hessians</span> <span class="o">=</span> <span class="n">Hs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_tgrads</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tgrads</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ints</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">scan_peaks</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_combine</span><span class="p">(</span><span class="n">scanned_optima</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_densities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_peaks</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_evidences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Zs</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_evidences_uncert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">tols</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Hessian Scan Fitting complete.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">23</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">23</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.hessian_scan.refit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">refit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">refit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># -------------------</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">lc_to_data</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">)</span>

    <span class="n">peaks</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_divide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_peaks</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">))</span>
    <span class="n">select</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_evidences_uncert</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_tol</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">_utils</span><span class="o">.</span><span class="n">isiter</span><span class="p">(</span><span class="n">select</span><span class="p">)):</span> <span class="n">select</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">select</span><span class="p">])</span>

    <span class="n">peaks</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">peaks</span><span class="p">)[</span><span class="n">select</span><span class="p">],</span> <span class="n">I</span><span class="p">[</span><span class="n">select</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Doing re-fitting of </span><span class="si">%i</span><span class="s2"> lags&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">))</span>
    <span class="n">newtols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">peak</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">)),</span> <span class="n">I</span><span class="p">,</span> <span class="n">peaks</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;:&quot;</span> <span class="o">*</span> <span class="mi">23</span><span class="p">,</span> <span class="s2">&quot;Refitting lag </span><span class="si">%i</span><span class="s2">/</span><span class="si">%i</span><span class="s2"> at lag </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">),</span> <span class="n">peak</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]),</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">ll_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="n">peak</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">old_tol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_evidences_uncert</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">new_peak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="n">peak</span><span class="p">,</span>
                                        <span class="n">optim_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">,</span>
                                        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                        <span class="n">optim_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer_args</span><span class="p">,</span>
                                        <span class="n">precondition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precondition</span>
                                        <span class="p">)</span>
        <span class="n">ll_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="n">new_peak</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ll_old</span> <span class="o">&gt;</span> <span class="n">ll_new</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ll_new</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;New peak bad (LL from </span><span class="si">%.2e</span><span class="s2"> to </span><span class="si">%.2e</span><span class="s2">. Trying new start location&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ll_old</span><span class="p">,</span> <span class="n">ll_new</span><span class="p">))</span>
            <span class="n">new_peak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">start_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span><span class="p">,</span>
                                            <span class="n">optim_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">,</span>
                                            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                            <span class="n">optim_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer_args</span><span class="p">,</span>
                                            <span class="n">precondition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precondition</span>
                                            <span class="p">)</span>
            <span class="n">ll_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="n">new_peak</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ll_old</span> <span class="o">&gt;</span> <span class="n">ll_new</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;New peak bad (LL from </span><span class="si">%.2e</span><span class="s2"> to </span><span class="si">%.2e</span><span class="s2">. Trying new start location&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ll_old</span><span class="p">,</span> <span class="n">ll_new</span><span class="p">))</span>
                <span class="k">continue</span>

        <span class="n">new_peak_uncon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">to_uncon</span><span class="p">(</span><span class="n">new_peak</span><span class="p">)</span>
        <span class="n">new_grad</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_pack</span><span class="p">(</span><span class="n">new_grad</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">)</span>
        <span class="n">new_hessian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density_uncon_hess</span><span class="p">(</span><span class="n">new_peak_uncon</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">laplace_log_evidence</span><span class="p">(</span><span class="n">new_peak</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">constrained</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constrained_domain</span><span class="p">)</span>
            <span class="n">tgrad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">uncon_grad_lag</span><span class="p">(</span><span class="n">new_peak</span><span class="p">)</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">tgrad</span> <span class="o">+</span> <span class="nb">int</span>
            <span class="n">Hinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">new_hessian</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Optimization failed on </span><span class="si">%i</span><span class="s2">/</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)))</span>
            <span class="k">continue</span>

        <span class="n">tol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">opt_tol</span><span class="p">(</span><span class="n">new_peak</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tol</span> <span class="o">&lt;</span> <span class="n">old_tol</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_tgrads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tgrad</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_ints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_evidences</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tgrad</span> <span class="o">+</span> <span class="nb">int</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_grads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_grad</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_hessians</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_hessian</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_evidences_uncert</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tol</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Settled at new tol </span><span class="si">%.2e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span>
                <span class="s2">&quot;Something went wrong at this refit! Consider changing the optimizer_args and trying again&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Refitting complete.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.hessian_scan.diagnostics" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">diagnostics</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">diagnostics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>

    <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_evidences_uncert</span>

    <span class="n">lagplot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_peaks</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span>
    <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_peaks</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="n">lagplot</span> <span class="o">=</span> <span class="n">lagplot</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estmap_tol</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>

    <span class="c1"># ---------</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Loss Norm, $ </span><span class="se">\\</span><span class="s2">vert \Delta x / \sigma_x </span><span class="se">\\</span><span class="s2">vert$&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Scan Lag No.&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lagplot</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Scan Losses&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">],</span> <span class="n">Y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Initial MAP Scan Loss&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_tol</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Nominal Tolerance Limit&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.05</span><span class="p">,</span> <span class="s2">&quot;How far each optimization slice is from its peak. Lower is good.&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.hessian_scan.diagnostic_lagplot" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">diagnostic_lagplot</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">diagnostic_lagplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">lags_forint</span><span class="p">,</span> <span class="n">logZ_forint</span><span class="p">,</span> <span class="n">density_forint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_slices</span><span class="p">(</span><span class="s1">&#39;lags&#39;</span><span class="p">,</span> <span class="s1">&#39;logZ&#39;</span><span class="p">,</span> <span class="s1">&#39;densities&#39;</span><span class="p">)</span>

    <span class="c1"># ---------------------</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">):</span>
        <span class="n">a</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_forint</span> <span class="o">-</span> <span class="n">logZ_forint</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Evidence&quot;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">density_forint</span> <span class="o">-</span> <span class="n">density_forint</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

    <span class="n">a2</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">a1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># --------------</span>
    <span class="c1"># Outputs</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.hessian_scan.get_evidence" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_evidence</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_evidence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">get_evidence</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># -------------------</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp_scale</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowable_interpscales</span><span class="p">,</span> <span class="s2">&quot;Interp scale </span><span class="si">%s</span><span class="s2"> not recognised. Must be selection from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interp_scale</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowable_interpscales</span><span class="p">)</span>

    <span class="n">lags_forint</span><span class="p">,</span> <span class="n">logZ_forint</span><span class="p">,</span> <span class="n">logZ_uncert_forint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_slices</span><span class="p">(</span><span class="s1">&#39;lags&#39;</span><span class="p">,</span> <span class="s1">&#39;logZ&#39;</span><span class="p">,</span> <span class="s1">&#39;dlogZ&#39;</span><span class="p">)</span>
    <span class="n">minlag</span><span class="p">,</span> <span class="n">maxlag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">maxlag</span> <span class="o">-</span> <span class="n">minlag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_forint</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">imax</span> <span class="o">=</span> <span class="n">logZ_forint</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
        <span class="n">uncert_plus</span><span class="p">,</span> <span class="n">uncert_minus</span> <span class="o">=</span> <span class="n">logZ_uncert_forint</span><span class="p">[</span><span class="n">imax</span><span class="p">],</span> <span class="n">logZ_uncert_forint</span><span class="p">[</span><span class="n">imax</span><span class="p">]</span>


    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp_scale</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">dlag</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">dlag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">dlag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">lags_forint</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">minlag</span>
            <span class="n">dlag</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">maxlag</span> <span class="o">-</span> <span class="n">lags_forint</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="n">dlogZ</span> <span class="o">=</span> <span class="n">logZ_forint</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dlag</span><span class="p">)</span>
            <span class="n">dZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">dlogZ</span> <span class="o">-</span> <span class="n">dlogZ</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">dZ</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">dlogZ</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="c1"># -------------------------------------</span>
            <span class="c1"># Get Uncertainties</span>

            <span class="c1"># todo Fix this to be generic and move outside of scope</span>
            <span class="c1"># Estimate uncertainty from ~dt^2 error scaling</span>
            <span class="n">dlag_sub</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">dlag_sub</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">dlag_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">lags_forint</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">minlag</span>
            <span class="n">dlag_sub</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">maxlag</span> <span class="o">-</span> <span class="n">lags_forint</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="n">dlogZ_sub</span> <span class="o">=</span> <span class="n">logZ_forint</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dlag_sub</span><span class="p">)</span>
            <span class="n">dZ_sub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">dlogZ_sub</span> <span class="o">-</span> <span class="n">dlogZ_sub</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">Z_subsample</span> <span class="o">=</span> <span class="n">dZ_sub</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">dlogZ_sub</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">uncert_numeric</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Z</span> <span class="o">-</span> <span class="n">Z_subsample</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>

            <span class="n">uncert_tol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">dZ</span> <span class="o">*</span> <span class="n">logZ_uncert_forint</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">uncert_tol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">uncert_tol</span><span class="p">)</span>
            <span class="n">uncert_tol</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">dlogZ</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>


        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp_scale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="c1"># dZ = dXdY/dln|Y|</span>
            <span class="n">dlag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">)</span>
            <span class="n">dY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_forint</span> <span class="o">-</span> <span class="n">logZ_forint</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
            <span class="n">dE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">logZ_forint</span><span class="p">)</span>
            <span class="n">dZ</span> <span class="o">=</span> <span class="n">dlag</span> <span class="o">*</span> <span class="n">dY</span> <span class="o">/</span> <span class="n">dE</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dZ</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_forint</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="n">uncert_tol</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_forint</span> <span class="o">-</span> <span class="n">logZ_forint</span><span class="o">.</span><span class="n">max</span><span class="p">())[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dZ</span> <span class="o">/</span> <span class="n">dE</span>
            <span class="p">)</span> <span class="o">*</span> <span class="n">logZ_uncert_forint</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">uncert_tol</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">logZ_uncert_forint</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_forint</span> <span class="o">-</span> <span class="n">logZ_forint</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">uncert_tol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">uncert_tol</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="n">uncert_tol</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_forint</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="n">dlag_sub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">dY_sub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_forint</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">logZ_forint</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
            <span class="n">dE_sub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">logZ_forint</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">dZ_sub</span> <span class="o">=</span> <span class="n">dlag_sub</span> <span class="o">*</span> <span class="n">dY_sub</span> <span class="o">/</span> <span class="n">dE_sub</span>
            <span class="n">Z_subsample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dZ_sub</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_forint</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">uncert_numeric</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Z</span> <span class="o">-</span> <span class="n">Z_subsample</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">msg_debug</span><span class="p">(</span><span class="s2">&quot;Evidence Est: </span><span class="se">\t</span><span class="s2"> </span><span class="si">%.2e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_debug</span><span class="p">(</span>
            <span class="s2">&quot;Evidence uncerts: </span><span class="se">\n</span><span class="s2"> Numeric: </span><span class="se">\t</span><span class="s2"> </span><span class="si">%.2e</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> Convergence: </span><span class="se">\t</span><span class="s2"> </span><span class="si">%.2e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uncert_numeric</span><span class="p">,</span> <span class="n">uncert_tol</span><span class="p">))</span>

        <span class="n">uncert_plus</span> <span class="o">=</span> <span class="n">uncert_numeric</span> <span class="o">+</span> <span class="n">uncert_tol</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">uncert_minus</span> <span class="o">=</span> <span class="n">uncert_numeric</span>

    <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Z</span><span class="p">,</span> <span class="o">-</span><span class="n">uncert_minus</span><span class="p">,</span> <span class="n">uncert_plus</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">uncert_minus</span> <span class="o">/</span> <span class="n">Z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">uncert_plus</span> <span class="o">/</span> <span class="n">Z</span><span class="p">)])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.hessian_scan.get_samples" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_samples</span><span class="p">(</span><span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}:</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">get_samples</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># -------------------</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp_scale</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowable_interpscales</span><span class="p">,</span> <span class="s2">&quot;Interp scale </span><span class="si">%s</span><span class="s2"> not recognised. Must be selection from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interp_scale</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allowable_interpscales</span><span class="p">)</span>
    <span class="n">lags_forint</span><span class="p">,</span> <span class="n">logZ_forint</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="n">covars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_slices</span><span class="p">(</span><span class="s1">&#39;lags&#39;</span><span class="p">,</span> <span class="s1">&#39;logZ&#39;</span><span class="p">,</span> <span class="s1">&#39;peaks&#39;</span><span class="p">,</span> <span class="s1">&#39;covars&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Zero good slices in evidence integral!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="c1"># Get weights and peaks etc</span>
    <span class="n">Npeaks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">)</span>
    <span class="n">minlag</span><span class="p">,</span> <span class="n">maxlag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span>

    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logZ_forint</span> <span class="o">-</span> <span class="n">logZ_forint</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="n">dlag</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">dlag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lags_forint</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">dlag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">lags_forint</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">minlag</span>
    <span class="n">dlag</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">maxlag</span> <span class="o">-</span> <span class="n">lags_forint</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dlag</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dlag</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">weights</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">*</span> <span class="n">dlag</span>
    <span class="n">weights</span> <span class="o">/=</span> <span class="n">weights</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Get hessians and peak locations</span>
    <span class="k">if</span> <span class="n">Npeaks</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Npeaks</span><span class="p">),</span> <span class="n">N</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="n">to_choose</span> <span class="o">=</span> <span class="p">[(</span><span class="n">I</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Npeaks</span><span class="p">)]</span>  <span class="c1"># number of samples to draw from peak i</span>

    <span class="c1"># Sweep over scan peaks and add scatter</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Npeaks</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">to_choose</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">peak_uncon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">to_uncon</span><span class="p">(</span><span class="n">peaks</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="c1"># Get normal dist properties in uncon space in vector form</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_pack</span><span class="p">(</span><span class="n">peak_uncon</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">)</span>
            <span class="n">cov</span> <span class="o">=</span> <span class="n">covars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># Generate samples</span>
            <span class="n">samps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="n">cov</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">to_choose</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">samps</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_unpack</span><span class="p">(</span><span class="n">samps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">samps</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_extend</span><span class="p">(</span><span class="n">peak_uncon</span><span class="p">,</span> <span class="n">samps</span><span class="p">)</span>

            <span class="c1"># Reconvert to constrained space</span>
            <span class="n">samps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">to_con</span><span class="p">(</span><span class="n">samps</span><span class="p">)</span>

            <span class="c1"># -------------</span>
            <span class="c1"># Add linear interpolation &#39;smudging&#39; to lags</span>
            <span class="k">if</span> <span class="n">Npeaks</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s1">&#39;lag&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">free_params</span><span class="p">():</span>

                <span class="c1"># Get nodes</span>
                <span class="n">tnow</span><span class="p">,</span> <span class="n">ynow</span> <span class="o">=</span> <span class="n">lags_forint</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">yprev</span><span class="p">,</span> <span class="n">ynext</span> <span class="o">=</span> <span class="n">ynow</span><span class="p">,</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">tprev</span><span class="p">,</span> <span class="n">tnext</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]),</span> <span class="n">lags_forint</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">Npeaks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">yprev</span><span class="p">,</span> <span class="n">ynext</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ynow</span>
                    <span class="n">tprev</span><span class="p">,</span> <span class="n">tnext</span> <span class="o">=</span> <span class="n">lags_forint</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">yprev</span><span class="p">,</span> <span class="n">ynext</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">tprev</span><span class="p">,</span> <span class="n">tnext</span> <span class="o">=</span> <span class="n">lags_forint</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags_forint</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="c1"># --</span>

                <span class="c1"># Perform CDF shift</span>
                <span class="n">Ti</span><span class="p">,</span> <span class="n">Yi</span> <span class="o">=</span> <span class="p">[</span><span class="n">tprev</span><span class="p">,</span> <span class="n">tnow</span><span class="p">,</span> <span class="n">tnext</span><span class="p">],</span> <span class="p">[</span><span class="n">yprev</span><span class="p">,</span> <span class="n">ynow</span><span class="p">,</span> <span class="n">ynext</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp_scale</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
                    <span class="n">tshift</span> <span class="o">=</span> <span class="n">linscatter</span><span class="p">(</span><span class="n">Ti</span><span class="p">,</span> <span class="n">Yi</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">to_choose</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp_scale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                    <span class="n">tshift</span> <span class="o">=</span> <span class="n">expscatter</span><span class="p">(</span><span class="n">Ti</span><span class="p">,</span> <span class="n">Yi</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">to_choose</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tshift</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Something wrong with the lag shift at node </span><span class="si">%i</span><span class="s2"> in sample generation&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">samps</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tshift</span>
            <span class="c1"># -------------</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">samps</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Something wrong with the lags at node </span><span class="si">%i</span><span class="s2"> in sample generation&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samps</span><span class="p">)</span>

    <span class="n">outs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="n">outs</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">()}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">outs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="litmus.fitting_methods.SVI_scan" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">SVI_scan</span><span class="p">(</span><span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span> <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="              hessian_scan(stat_model: stats_model, out_stream=sys.stdout, err_stream=sys.stderr, verbose=True, debug=False, **fit_params) (litmus.fitting_methods.hessian_scan)" href="#litmus.fitting_methods.hessian_scan">hessian_scan</a></code></p>


        <p>An alternative to hessian_scan that fits each slice with stochastic variational
inference instead of the laplace approximation. Typically slower, but more robust against numerical failure in
low SNR signals and gives more accurate evidence estimates.</p>

        <p>Inherits all fitting parameters and their default values from hessian_scan, but gains new parameters</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ELBO_threshold</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If a slice log-evidence decreases by this amount or more, consider it a furrow. Defaults to 100.0.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ELBO_optimstep</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of the stochastic optimisation step in adam. Defaults to 5E-3.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ELBO_particles</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of particles for estimating the ELBO at each optimisation step. Defaults to 128.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ELBO_Nsteps</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of steps to take in optimisation of the ELBO for each slice. Defaults to 128.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ELBO_Nsteps_init</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of steps to take in finding the initial slice ELBO / solution. Defaults to 1_000.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ELBO_fraction</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fraction of the ELBO run (both slice and initial) to search for minimum variance estimate. Defaults to 0.25.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span>
             <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inherits all fitting parameters and their default values from hessian_scan, but gains new parameters</span>

<span class="sd">    :param float ELBO_threshold: If a slice log-evidence decreases by this amount or more, consider it a furrow. Defaults to 100.0.</span>
<span class="sd">    :param float ELBO_optimstep: Size of the stochastic optimisation step in adam. Defaults to 5E-3.</span>
<span class="sd">    :param int ELBO_particles: Number of particles for estimating the ELBO at each optimisation step. Defaults to 128.</span>
<span class="sd">    :param int ELBO_Nsteps: Number of steps to take in optimisation of the ELBO for each slice. Defaults to 128.</span>
<span class="sd">    :param int ELBO_Nsteps_init: Number of steps to take in finding the initial slice ELBO / solution. Defaults to 1_000.</span>
<span class="sd">    :param int ELBO_fraction: Fraction of the ELBO run (both slice and initial) to search for minimum variance estimate. Defaults to 0.25.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args_in</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="nb">locals</span><span class="p">(),</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">}</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;__class__&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_default_params&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">|=</span> <span class="p">{</span>
        <span class="s1">&#39;ELBO_threshold&#39;</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span>
        <span class="s1">&#39;ELBO_optimstep&#39;</span><span class="p">:</span> <span class="mf">5E-3</span><span class="p">,</span>
        <span class="s1">&#39;ELBO_particles&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
        <span class="s1">&#39;ELBO_Nsteps&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
        <span class="s1">&#39;ELBO_Nsteps_init&#39;</span><span class="p">:</span> <span class="mi">1_000</span><span class="p">,</span>
        <span class="s1">&#39;ELBO_fraction&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">args_in</span><span class="p">)</span>

    <span class="c1"># -----------------------------</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;SVI Scan Fitting Procedure&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_loss_init</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_ints</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.SVI_scan.name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;SVI Scan Fitting Procedure&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.SVI_scan.diagnostic_losses" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">diagnostic_losses</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.SVI_scan.diagnostic_loss_init" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">diagnostic_loss_init</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.SVI_scan.diagnostic_ints" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">diagnostic_ints</span> <span class="o">=</span> <span class="p">[]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.SVI_scan.fit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># -------------------</span>
    <span class="n">fitting_procedure</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempseed</span>
    <span class="c1"># -------------------</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Starting SVI Scan&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_prefit</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">lc_to_data</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">)</span>

    <span class="c1"># ----------------------------------</span>
    <span class="c1"># Estimate the MAP and its hessian for starting conditions</span>

    <span class="n">estmap_uncon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">to_uncon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span><span class="p">)</span>

    <span class="n">fix_param_dict_con</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">fixed_params</span><span class="p">()}</span>
    <span class="n">fix_param_dict_uncon</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">estmap_uncon</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">fixed_params</span><span class="p">()}</span>

    <span class="n">init_hess</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density_uncon_hess</span><span class="p">(</span><span class="n">estmap_uncon</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">)</span>

    <span class="c1"># Convert these into SVI friendly objects and fit an SVI at the map</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Performing SVI slice at the MAP estimate&quot;</span><span class="p">)</span>
    <span class="n">init_loc</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_pack</span><span class="p">(</span><span class="n">estmap_uncon</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">)</span>
    <span class="n">init_tril</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">init_hess</span><span class="p">))</span>

    <span class="n">bad_starts</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">init_loc</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">init_tril</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Issue with finding initial solver state for SVI. Proceeding /w numpyro defaults&quot;</span><span class="p">)</span>
        <span class="n">bad_starts</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># ----------------------------------</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">msg_debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Constructing slice model&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">slice_function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lag</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is the conditional model that SVI will map</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">free_params</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;lag&#39;</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">quickprior</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="n">params</span> <span class="o">|=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span><span class="p">}</span>
        <span class="n">params</span> <span class="o">|=</span> <span class="p">{</span><span class="s1">&#39;lag&#39;</span><span class="p">:</span> <span class="n">lag</span><span class="p">}</span>
        <span class="n">params</span> <span class="o">|=</span> <span class="n">fix_param_dict_con</span>

        <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="n">hide</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">()):</span>
            <span class="n">LL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">_log_likelihood</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="n">dilute</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">][</span>
            <span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;lag&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">free_params</span><span class="p">()</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">numpyro</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="s1">&#39;lag_prior&#39;</span><span class="p">,</span> <span class="n">dilute</span><span class="p">)</span>

    <span class="c1"># SVI settup</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">msg_debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Constructing and running optimizer and SVI guides&quot;</span><span class="p">)</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">step_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ELBO_optimstep</span><span class="p">)</span>
    <span class="n">autoguide</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">autoguide</span><span class="o">.</span><span class="n">AutoMultivariateNormal</span><span class="p">(</span><span class="n">slice_function</span><span class="p">)</span>
    <span class="n">autosvi</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">SVI</span><span class="p">(</span><span class="n">slice_function</span><span class="p">,</span> <span class="n">autoguide</span><span class="p">,</span> <span class="n">optim</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                                <span class="n">loss</span><span class="o">=</span><span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ELBO_particles</span><span class="p">),</span>
                                <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Running SVI&quot;</span><span class="p">)</span>
    <span class="n">MAP_SVI_results</span> <span class="o">=</span> <span class="n">autosvi</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">seed</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELBO_Nsteps_init</span><span class="p">,</span>
                                  <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span><span class="p">[</span><span class="s1">&#39;lag&#39;</span><span class="p">],</span>
                                  <span class="n">init_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;auto_loc&#39;</span><span class="p">:</span> <span class="n">init_loc</span><span class="p">,</span>
                                               <span class="s1">&#39;auto_scale_tril&#39;</span><span class="p">:</span> <span class="n">init_tril</span>
                                               <span class="p">}</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bad_starts</span> <span class="k">else</span> <span class="kc">None</span>
                                  <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Success. Extracting solution&quot;</span><span class="p">)</span>
    <span class="n">BEST_loc</span><span class="p">,</span> <span class="n">BEST_tril</span> <span class="o">=</span> <span class="n">MAP_SVI_results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;auto_loc&#39;</span><span class="p">],</span> <span class="n">MAP_SVI_results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;auto_scale_tril&#39;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_loss_init</span> <span class="o">=</span> <span class="n">MAP_SVI_results</span><span class="o">.</span><span class="n">losses</span>

    <span class="c1"># ----------------------------------</span>
    <span class="c1"># Main Scan</span>

    <span class="n">lags_forscan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lags</span>
    <span class="n">l_old</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="n">scanned_optima</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ELBOS_tosave</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ElBOS_uncert</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">diagnostic_hessians</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">diagnostic_losses</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lags_forscan</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;:&quot;</span> <span class="o">*</span> <span class="mi">23</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Doing SVI fit at lag=</span><span class="si">%.2f</span><span class="s2"> ...&quot;</span> <span class="o">%</span> <span class="n">lag</span><span class="p">)</span>

        <span class="n">svi_loop_result</span> <span class="o">=</span> <span class="n">autosvi</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">seed</span><span class="p">),</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">ELBO_Nsteps</span><span class="p">,</span>
                                      <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="n">lag</span><span class="p">,</span>
                                      <span class="n">init_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;auto_loc&#39;</span><span class="p">:</span> <span class="n">BEST_loc</span><span class="p">,</span>
                                                   <span class="s1">&#39;auto_scale_tril&#39;</span><span class="p">:</span> <span class="n">BEST_tril</span>
                                                   <span class="p">},</span>
                                      <span class="n">progress_bar</span><span class="o">=</span><span class="kc">False</span>
                                      <span class="p">)</span>

        <span class="n">NEW_loc</span><span class="p">,</span> <span class="n">NEW_tril</span> <span class="o">=</span> <span class="n">svi_loop_result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;auto_loc&#39;</span><span class="p">],</span> <span class="n">svi_loop_result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;auto_scale_tril&#39;</span><span class="p">]</span>

        <span class="c1"># --------------</span>
        <span class="c1"># Check if the optimization has suceeded or broken</span>

        <span class="n">l_old</span> <span class="o">=</span> <span class="n">l_old</span>
        <span class="n">l_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getELBO</span><span class="p">(</span><span class="n">svi_loop_result</span><span class="o">.</span><span class="n">losses</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">diverged</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">NEW_loc</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">NEW_tril</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>
        <span class="n">big_drop</span> <span class="o">=</span> <span class="n">l_new</span> <span class="o">-</span> <span class="n">l_old</span> <span class="o">&lt;</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELBO_threshold</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span>
            <span class="s2">&quot;From </span><span class="si">%.2f</span><span class="s2"> to </span><span class="si">%.2f</span><span class="s2">, change of </span><span class="si">%.2f</span><span class="s2"> against </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">l_old</span><span class="p">,</span> <span class="n">l_new</span><span class="p">,</span> <span class="n">l_new</span> <span class="o">-</span> <span class="n">l_old</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELBO_threshold</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">big_drop</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">diverged</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Seems to have converged at iteration </span><span class="si">%i</span><span class="s2"> / </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">converged</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">l_old</span> <span class="o">=</span> <span class="n">l_new</span>
            <span class="n">BEST_loc</span><span class="p">,</span> <span class="n">BEST_tril</span> <span class="o">=</span> <span class="n">NEW_loc</span><span class="p">,</span> <span class="n">NEW_tril</span>

            <span class="n">uncon_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">to_uncon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estmap_params</span> <span class="o">|</span> <span class="p">{</span><span class="s1">&#39;lag&#39;</span><span class="p">:</span> <span class="n">lag</span><span class="p">})</span> <span class="o">|</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_unpack</span><span class="p">(</span><span class="n">NEW_loc</span><span class="p">,</span>
                                                                                                            <span class="bp">self</span><span class="o">.</span><span class="n">params_toscan</span><span class="p">)</span>
            <span class="n">con_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">to_con</span><span class="p">(</span><span class="n">uncon_params</span><span class="p">)</span>
            <span class="n">scanned_optima</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">con_params</span><span class="p">)</span>

            <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">NEW_tril</span><span class="p">,</span> <span class="n">NEW_tril</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">H</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span> <span class="o">+</span> <span class="n">H</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="o">-</span><span class="n">H</span><span class="p">)</span>
            <span class="n">diagnostic_hessians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>

            <span class="n">diagnostic_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">svi_loop_result</span><span class="o">.</span><span class="n">losses</span><span class="p">)</span>

            <span class="n">ELBO</span><span class="p">,</span> <span class="n">uncert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getELBO</span><span class="p">(</span><span class="n">svi_loop_result</span><span class="o">.</span><span class="n">losses</span><span class="p">)</span>
            <span class="n">ELBOS_tosave</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ELBO</span><span class="p">)</span>
            <span class="n">ElBOS_uncert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uncert</span><span class="p">)</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Unable to converge at iteration </span><span class="si">%i</span><span class="s2"> / </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nlags</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_debug</span><span class="p">(</span><span class="s2">&quot;Reason for failure: </span><span class="se">\n</span><span class="s2"> large ELBO drop: </span><span class="se">\t</span><span class="s2"> </span><span class="si">%r</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> diverged: </span><span class="se">\t</span><span class="s2"> </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">big_drop</span><span class="p">,</span> <span class="n">diverged</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Scanning Complete. Calculating ELBO integrals...&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">converged</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;All slices catastrophically diverged! Try different starting conditions and/or grid spacing&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ELBOS_tosave</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">log_evidences_uncert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ElBOS_uncert</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_losses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">diagnostic_losses</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_hessians</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">diagnostic_hessians</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">scan_peaks</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_combine</span><span class="p">(</span><span class="n">scanned_optima</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_densities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">log_density</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_peaks</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------------------</span>
    <span class="c1"># For each of these peaks, estimate the evidence</span>
    <span class="c1"># todo - vmap and parallelize</span>

    <span class="n">Zs</span><span class="p">,</span> <span class="n">tgrads</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scanned_optima</span><span class="p">):</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_ints</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">tgrad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">uncon_grad_lag</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">constrained_domain</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">tgrad</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tgrads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tgrad</span><span class="p">)</span>
        <span class="n">Zs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Z</span> <span class="o">+</span> <span class="n">tgrad</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">log_evidences</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Zs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_tgrads</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tgrads</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;SVI Fitting complete.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">23</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">23</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.SVI_scan.refit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">refit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">refit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># TODO - fill this out</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.SVI_scan.diagnostics" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">diagnostics</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">diagnostics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_types</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>

    <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_losses</span><span class="p">):</span>
        <span class="n">a1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_ints</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">a2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diagnostic_loss_init</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="n">a1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELBO_fraction</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELBO_Nsteps</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

    <span class="n">a1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">)</span>
    <span class="n">a2</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">)</span>
    <span class="n">a1</span><span class="o">.</span><span class="n">grid</span><span class="p">(),</span> <span class="n">a2</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

    <span class="n">a1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELBO_Nsteps</span><span class="p">)</span>
    <span class="n">a2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ELBO_Nsteps_init</span><span class="p">)</span>

    <span class="n">a1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Scan SVIs&quot;</span><span class="p">)</span>
    <span class="n">a2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Initial MAP SVI&quot;</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">supylabel</span><span class="p">(</span><span class="s2">&quot;Loss - loss_final (log scale)&quot;</span><span class="p">)</span>
    <span class="n">a1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;iteration Number&quot;</span><span class="p">),</span> <span class="n">a2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;iteration Number&quot;</span><span class="p">)</span>

    <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Trace plots of ELBO convergence. All lines should be flat by the right hand side.</span><span class="se">\n</span><span class="s2">&quot;</span> \
          <span class="s2">&quot;Top panel is for initial guess and need only be flat. Bottom panel should be flat within&quot;</span> \
          <span class="s2">&quot;averaging range, i.e. to the right of dotted line.&quot;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">supxlabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\b</span><span class="s1">egin</span><span class="si">{center}</span><span class="s1">X-axis</span><span class="se">\\</span><span class="s1">*</span><span class="se">\t</span><span class="s1">extit{\small{</span><span class="si">%s</span><span class="s1">}}\end</span><span class="si">{center}</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="n">txt</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="litmus.fitting_methods.JAVELIKE" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>              <code class="highlight language-python"><span class="n">JAVELIKE</span><span class="p">(</span><span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span> <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="              fitting_procedure(stat_model: stats_model, out_stream=sys.stdout, err_stream=sys.stderr, verbose=True, debug=True, **fit_params) (litmus.fitting_methods.fitting_procedure)" href="#litmus.fitting_methods.fitting_procedure">fitting_procedure</a></code></p>


        <p>A direct MCMC implementation using the AEIS in the style of JAVELIN
Note that, because NumPyro fits in the unconstrained domain while JAVELIN fits in the constrained domain,
the behaviour of the two will be slightly different near the prior boundaries.</p>
<p>Note that this is for example / comparison only, and <em>should not be used for actual fitting</em> as it cannot handle
the multimodal distributions of seasonal lightcurves</p>

        


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of the stretch in the stretch-move. Defaults to 2.0.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_chains</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Num live points in the AEIS ensemble. Defaults to 256.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_samples</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Samples per live point in the AEIS chain. Defaults to 200_000 // 256 per chain total (i.e. 200_000 total)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_warmup</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of warmup samples per chain. Defaults to 5_000.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







                  <details class="quote">
                    <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stat_model</span><span class="p">:</span> <span class="n">stats_model</span><span class="p">,</span>
             <span class="n">out_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">err_stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param float alpha: Size of the stretch in the stretch-move. Defaults to 2.0.</span>
<span class="sd">    :param float num_chains: Num live points in the AEIS ensemble. Defaults to 256.</span>
<span class="sd">    :param float num_samples: Samples per live point in the AEIS chain. Defaults to 200_000 // 256 per chain total (i.e. 200_000 total)</span>
<span class="sd">    :param float num_warmup: Number of warmup samples per chain. Defaults to 5_000.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args_in</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="nb">locals</span><span class="p">(),</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">}</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;__class__&#39;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">args_in</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_default_params&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_default_params</span> <span class="o">|=</span> <span class="p">{</span>
        <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
        <span class="s1">&#39;num_chains&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
        <span class="s1">&#39;num_samples&#39;</span><span class="p">:</span> <span class="mi">200_000</span> <span class="o">//</span> <span class="mi">256</span><span class="p">,</span>
        <span class="s1">&#39;num_warmup&#39;</span><span class="p">:</span> <span class="mi">5_000</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="p">:</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">MCMC</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NumPyro MCMC wrapper&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">:</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">AEIS</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;numpyro MCMC sampler kernel to use&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">limited_model</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The function to deploy the AEIS against&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">args_in</span><span class="p">)</span>

    <span class="c1"># -----------------------------</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;AEIS JAVELIN Emulator fitting Procedure&quot;</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.JAVELIKE.sampler" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">sampler</span><span class="p">:</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">MCMC</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>NumPyro MCMC wrapper</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.JAVELIKE.kernel" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">kernel</span><span class="p">:</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">AEIS</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>numpyro MCMC sampler kernel to use</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.JAVELIKE.limited_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">limited_model</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The function to deploy the AEIS against</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="litmus.fitting_methods.JAVELIKE.name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <code class="highlight language-python"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;AEIS JAVELIN Emulator fitting Procedure&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.JAVELIKE.readyup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">readyup</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">readyup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">fixed_vals</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior_ranges</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">fixed_params</span><span class="p">()}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">limited_model</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="n">hide</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">fixed_params</span><span class="p">()):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">prior</span><span class="p">())}</span>

        <span class="n">params</span> <span class="o">|=</span> <span class="n">fixed_vals</span>
        <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="n">hide</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">paramnames</span><span class="p">()):</span>
            <span class="n">LL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">_log_density</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="n">numpyro</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="s1">&#39;ll&#39;</span><span class="p">,</span> <span class="n">LL</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">limited_model</span> <span class="o">=</span> <span class="n">limited_model</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">AIES</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">limited_model</span><span class="p">,</span>
                                     <span class="n">moves</span><span class="o">=</span><span class="p">{</span><span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">AIES</span><span class="o">.</span><span class="n">StretchMove</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">):</span> <span class="mf">1.0</span><span class="p">}</span>
                                     <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">MCMC</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">,</span>
                                      <span class="n">num_warmup</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_warmup</span><span class="p">,</span>
                                      <span class="n">num_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_samples</span><span class="p">,</span>
                                      <span class="n">num_chains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_chains</span><span class="p">,</span>
                                      <span class="n">chain_method</span><span class="o">=</span><span class="s1">&#39;vectorized&#39;</span><span class="p">,</span>
                                      <span class="n">progress_bar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.JAVELIKE.prefit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">prefit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prefit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">readyup</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Running warmup with </span><span class="si">%i</span><span class="s2"> chains and </span><span class="si">%i</span><span class="s2"> samples&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_chains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_warmup</span><span class="p">))</span>
    <span class="c1"># self.sampler.warmup(jax.random.PRNGKey(seed), self.stat_model.lc_to_data(lc_1, lc_2))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">has_prefit</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.JAVELIKE.fit" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lc_1</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">:</span> <span class="n">lightcurve</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">readyup</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_prefit</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefit</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">msg_run</span><span class="p">(</span><span class="s2">&quot;Running sampler with </span><span class="si">%i</span><span class="s2"> chains and </span><span class="si">%i</span><span class="s2"> samples&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_chains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_samples</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">seed</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">stat_model</span><span class="o">.</span><span class="n">lc_to_data</span><span class="p">(</span><span class="n">lc_1</span><span class="p">,</span> <span class="n">lc_2</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="litmus.fitting_methods.JAVELIKE.get_samples" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_samples</span><span class="p">(</span><span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}</span></code>

</h5>


    <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>litmus/fitting_methods.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">importance_sampling</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="nb">str</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">]}:</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_run</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Can&#39;t get samples before running!&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">importance_sampling</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;JAVELIKE Already distributed according to posterior (ideally)&quot;</span><span class="p">)</span>
    <span class="n">samps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">get_samples</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">N</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">_utils</span><span class="o">.</span><span class="n">dict_dim</span><span class="p">(</span><span class="n">samps</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="n">N</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_err</span><span class="p">(</span><span class="s2">&quot;Tried to get </span><span class="si">%i</span><span class="s2"> sub-samples from chain of </span><span class="si">%i</span><span class="s2"> total samples.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">N</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">samps</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">samps</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">I</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">samps</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">samps</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["search.suggest", "search.highlight", "search.tabs.link", "navigation.expand", "toc.follow", "navigation.tracking", "toc.integrate"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>